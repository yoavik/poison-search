{% extends "base.html" %}
{% block content %}
<h2 class="page-title">תוצאות חיפוש</h2>
<div class="card elevate">
  <div class="row" style="align-items:center">
    <div>
      <div><strong>שאילתה:</strong> <code>{{ query }}</code></div>
      <div class="small muted">
        מצב: {{ mode }} | תוצאות מקסימליות: {{ max_results }} | מינ' לייקים: {{ min_likes }}
        {% if since_date %}| מתאריך: {{ since_date }}{% endif %}
        {% if until_date %}| עד תאריך: {{ until_date }}{% endif %}
      </div>
    </div>
    <div class="actions" style="margin-left:auto">
      <form method="post" action="/export" style="display:inline">
        <input type="hidden" name="phrase" value="{{ phrase }}">
        <input type="hidden" name="mode" value="{{ mode }}">
        <input type="hidden" name="max_results" value="{{ max_results }}">
        <input type="hidden" name="min_likes" value="{{ min_likes }}">
        {% for a in authors %}<input type="hidden" name="authors" value="{{ a }}">{% endfor %}
        <button type="submit">⬇️ ייצוא CSV</button>
      </form>
      <form method="post" action="/export_xlsx" style="display:inline">
        <input type="hidden" name="phrase" value="{{ phrase }}">
        <input type="hidden" name="mode" value="{{ mode }}">
        <input type="hidden" name="max_results" value="{{ max_results }}">
        <input type="hidden" name="min_likes" value="{{ min_likes }}">
        {% for a in authors %}<input type="hidden" name="authors" value="{{ a }}">{% endfor %}
        <button type="submit" class="primary">⬇️ ייצוא Excel / Sheets</button>
      </form>
    </div>
  </div>
</div>

<p class="small muted">נמצאו {{ count }} ציוצים.</p>
{% if authors and authors|length > 0 %}
<p class="small muted"><strong>משתמשים מסוננים:</strong> {% for a in authors %}<code>@{{ a }}</code>{% if not loop.last %}, {% endif %}{% endfor %}</p>
{% endif %}

<table class="list elevate">
  <thead>
    <tr>
      <th>זמן</th>
      <th>משתמש</th>
      <th>טקסט</th>
      <th>❤️</th>
      <th>🔁</th>
      <th>💬</th>
      <th>צפיות</th>
      <th>קישור</th>
    </tr>
  </thead>
  <tbody>
    {% for t in items %}
    <tr>
      <td>{{ t.createdAt }}</td>
      <td class="usercell">
  <div class="userwrap">
    <img class="avatar" src="{{ t.author_avatar }}" alt="" onerror="this.style.display='none'">
    <div class="usernames">
      <div class="uname">@{{ t.author_userName }}</div>
      {% if t.author_name %}<div class="name small muted">{{ t.author_name }}</div>{% endif %}
    </div>
  </div>
</td>
      <td class="text">{{ t.text_highlight | safe }}</td>
      <td>{{ t.likeCount }}</td>
      <td>{{ t.retweetCount }}</td>
      <td>{{ t.replyCount }}</td>
      <td>{{ t.viewCount }}</td>
      <td><a href="{{ t.url }}" target="_blank">פתח</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
