{% extends "base.html" %}
{% block content %}
<h2>תוצאות חיפוש</h2>
<form method="post" action="/export" class="card" style="display:flex;gap:.5rem;align-items:center">
  <input type="hidden" name="phrase" value="{{ phrase }}">
  <input type="hidden" name="mode" value="{{ mode }}">
  <input type="hidden" name="max_results" value="{{ max_results }}">
  <input type="hidden" name="min_likes" value="{{ min_likes }}">
  {% for a in authors %}
  <input type="hidden" name="authors" value="{{ a }}">
  {% endfor %}
  <button type="submit">⬇️ ייצוא ל‑CSV</button>
</form>
<p><strong>שאילתה:</strong> <code>{{ query }}</code></p>
<p><strong>נמצאו:</strong> {{ count }} ציוצים</p>
{% if authors and authors|length > 0 %}
<p><strong>משתמשים מסוננים:</strong> {% for a in authors %}<code>@{{ a }}</code>{% if not loop.last %}, {% endif %}{% endfor %}</p>
{% endif %}

<table class="list">
  <thead>
    <tr>
      <th>זמן</th>
      <th>משתמש</th>
      <th>טקסט</th>
      <th>❤️</th>
      <th>🔁</th>
      <th>💬</th>
      <th>צפיות</th>
      <th>קישור</th>
    </tr>
  </thead>
  <tbody>
    {% for t in items %}
    <tr>
      <td>{{ t.createdAt }}</td>
      <td>@{{ t.author_userName }}</td>
      <td class="text">{{ t.text_highlight | safe }}</td>
      <td>{{ t.likeCount }}</td>
      <td>{{ t.retweetCount }}</td>
      <td>{{ t.replyCount }}</td>
      <td>{{ t.viewCount }}</td>
      <td><a href="{{ t.url }}" target="_blank">פתח</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
