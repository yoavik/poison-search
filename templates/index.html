{% extends "base.html" %}
{% set hide_home_button = True %}
{% block content %}
<h2>חיפוש ביטוי/מילה</h2>
<form method="post" action="/search" class="card">
  <label>ביטוי לחיפוש (רצוי במרכאות):
    <input type="text" name="phrase" placeholder='"דוגמה לביטוי"' required>
  </label>
  <div class="row">
    <label>מצב:
      <select name="mode">
        <option value="Latest" selected>Latest</option>
        <option value="Top">Top</option>
      </select>
    </label>
    <label>מספר תוצאות מקסימלי:
      <select name="max_results">
        <option value="20">20</option>
        <option value="40" selected>40</option>
        <option value="60">60</option>
        <option value="100">100</option>
        <option value="200">200</option>
      </select>
    </label>
  </div>
  <div class="row">
    <label>סינון לייקים מינימלי:
      <input type="number" name="min_likes" value="0" min="0">
    </label>
  </div>

  <div class="card" style="margin-top:.5rem">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:1rem">
      <h3 style="margin:.2rem 0">סינון לפי משתמשים</h3>
      <div>
        <button type="button" class="btn-ghost" onclick="pm_selectAll(true)">בחר הכל</button>
        <button type="button" class="btn-ghost" onclick="pm_selectAll(false)">נקה הכל</button>
      </div>
    </div>
    <div id="authors-grid" class="chk-grid">
      {% for a in accounts %}
      <label class="chk-item">
        <input type="checkbox" name="authors" value="{{ a }}">
        <span>@{{ a }}</span>
      </label>
      {% endfor %}
    </div>
    <small>(אם לא מסמנים — נחפש בכל המשתמשים)</small>
  </div>

  <details>
    <summary>חשבונות פעילים בחיפוש (תצוגה בלבד)</summary>
    <p>
      {% for a in accounts %}
        <code>@{{ a }}</code>{% if not loop.last %}, {% endif %}
      {% endfor %}
    </p>
  </details>
  <button type="submit">🔎 חפש</button>
</form>

<script>
function pm_selectAll(flag){
  document.querySelectorAll('input[name="authors"]').forEach(cb => cb.checked = !!flag);
}
</script>
{% endblock %}
